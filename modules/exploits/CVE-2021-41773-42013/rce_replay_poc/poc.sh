#!/bin/bash

if [ "$#" -lt 4 ] || [ "$#" -gt 5 ]; then
  echo "Usage: $0 <HOST> <HTTP_PATH> <HTTP_METHOD> <TIMEOUT> [COMMAND]"
  exit 1
fi

HOST=$1
HTTP_PATH=$2
HTTP_METHOD=$3
TIMEOUT=$4

if [ "$#" -eq 5 ]; then
  COMMAND=$5
  DATA="echo Content-Type: text/plain; echo; $COMMAND"
else
  DATA=""
fi

response=$(curl -sS -m "$TIMEOUT" -X "$HTTP_METHOD" "$HOST$HTTP_PATH" --data "$DATA" -w "\nHTTP Response Status Code: %{http_code}\n" -o - --no-progress-meter)
exit_code=$?

if [ $exit_code -eq 7 ]; then
  echo "Failed to connect to host. Error code: $exit_code"
  exit 0
else
  echo "$response"
fi