---
name: MSF/exploit-scanner/multi/http/apache_normalize_path_rce
module_class: scanner
module_type: msf
path: exploit/multi/http/apache_normalize_path_rce
exec_mode: check
parameters:
  - name: RHOSTS
    description: Remote host IP
    value:
      method: event_data
      argument: dest_ip
  - name: RPORT
    description: Remote host port
    value:
      method: event_data
      argument: dest_port
  - name: TARGETURI
    description: Relative path of the CGI directory
    value_default: /cgi-bin
    value:
      method: extract
      argument: ^((?:/[^/%]+)+)(?=/?\.%)  # extract all directory before the first directory traversal sequence
      input:
        method: event_data
        argument: http.url
  - name: VHOST
    description: SNI name of the Apache server
    value:
      method: exists
      argument: 
      input:
        - method: event_data
          argument: http.hostname
        - method: event_data
          argument: dest_ip
  - name: PAYLOAD
    description: the payload to use
    value_default: linux/x64/meterpreter/reverse_tcp
success:
  - strategy: output
    argument: "The target is vulnerable"
    conclusion: yes
  - strategy: fallback
    conclusion: no
